import { Component,OnInit } from '@angular/core';
import {NavController, NavParams,ToastController } from 'ionic-angular';
import {FormGroup,FormControl,Validators} from '@angular/forms'

import {FCM} from '@ionic-native/fcm';
import {Md5} from "md5-typescript";

import {AppService } from '../../app/app.service';
@Component({
  selector: 'page-vulnerability-scanner',
  templateUrl: 'vulnerability-scanner.html',
})
export class VulnerabilityScannerPage implements OnInit {
  requestForm: FormGroup;
  token:any;
  constructor(public navCtrl: NavController, public navParams: NavParams,private service:AppService,
              private fcm:FCM,public toastCtrl:ToastController) {
  }
  ngOnInit(){
    this.fcm.getToken().then(token=>{
      this.token = token;
    });
    this.requestForm = new FormGroup({
      'url': new FormControl(null,Validators.required),
      'filename': new FormControl(null,Validators.required),
      'testType': new FormControl(null,Validators.required)
    })
  }
  ionViewDidLoad() {
    console.log('ionViewDidLoad VulnerabilityScannerPage');
  }
  submitRequest(){
    
    if(this.requestForm.value.testType=='xss_check'){
      // alert(JSON.stringify(this.requestForm));
      console.log(this.requestForm);
      this.xss();
    }
    else if(this.requestForm.value.testType=='testssl'){
      // alert(JSON.stringify(this.requestForm));
      this.ssl();
    }
    else{
      this.nessus();
    }
    
  }
  xss(){
    let body = {
      url : this.requestForm.value.url,
      filename: this.requestForm.value.filename,
      reg_token: this.token
    };
    alert(JSON.stringify(body));
    this.service.getData1(body,'xss_check')
      .subscribe();
      this.toastFunc();
    
  }
  ssl(){
    let body = {
      url : this.requestForm.value.url,
      filename: this.requestForm.value.filename,
      reg_token: this.token
    };
    console.log(body);
    this.service.getData1(body,'testssl')
      .subscribe();
      this.toastFunc();
  }
  nessus(){
    let body = {
      url : this.requestForm.value.url,
      filename: this.requestForm.value.filename,
      reg_token: this.token
    };
    console.log(body);
    this.service.getData1(body,'test_nessus')
      .subscribe();
      this.toastFunc();
    
  }
  toastFunc(){
    let toast = this.toastCtrl.create({
      message: 'Notification will be sent when report is generated',
      duration: 3000,
      position: 'bottom'
    });
    toast.present();
  }
}
