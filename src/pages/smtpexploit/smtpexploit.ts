import { Component,OnInit } from '@angular/core';
import { NavController,ViewController, NavParams,LoadingController,ToastController } from 'ionic-angular';
import {FormGroup,FormControl,Validators} from '@angular/forms';

import {AppService } from '../../app/app.service';
@Component({
  selector: 'page-smtpexploit',
  templateUrl: 'smtpexploit.html',
})
export class SmtpexploitPage implements OnInit {
  smtpRequest:FormGroup;
  constructor(public navCtrl: NavController, public navParams: NavParams,private viewCtrl:ViewController,
              public service:AppService,public loadingCtrl:LoadingController,public toastCtrl:ToastController) {
    
  }
  ngOnInit(){
    this.smtpRequest = new FormGroup({
      'senderEmail': new FormControl(null,[Validators.required,Validators.email]),
      'recieverEmail': new FormControl(null,[Validators.required,Validators.email]),
      'emailSubject': new FormControl(null, Validators.required),
      'emailBody': new FormControl(null, Validators.required)
    });
    console.log(this.navParams.data.url);
  }
  ionViewDidLoad() {
    console.log('ionViewDidLoad SmtpexploitPage');
    
  }
  submitForm(){
    let data = this.navParams.get('data')
    
    console.log("Hello");
    console.log(this.smtpRequest);
    let loading = this.loadingCtrl.create({
      content: 'Please wait...'
    });
    loading.present();
    let body = {
      url : data.url,
      sender: this.smtpRequest.value.senderEmail,
      recipient: this.smtpRequest.value.recieverEmail,
      mailSubject: this.smtpRequest.value.emailSubject,
      mailBody: this.smtpRequest.value.emailBody
    };
    console.log(body);
    this.service.getData(body,'smtp_exploit').
    subscribe(
      (result:any)=>{
        let toast = this.toastCtrl.create({
          message: 'Exploit Successful',
          duration: 3000,
          position: 'bottom'
        });
        toast.present();
        loading.dismiss();
        
      },
      (error)=>{
        loading.dismiss();
        alert(JSON.stringify(error));
      }
    )
  }
  closeModal(){
    this.viewCtrl.dismiss();
  }

}
